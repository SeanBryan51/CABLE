<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Documentation for CABLE">
    <meta name="author" content="CABLE community" >
    <link rel="icon" href="../favicon.png">

    <title>update_zetar &ndash; CABLE</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

         <script src="../js/jquery-2.1.3.min.js"></script>
         <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">CABLE </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
                 data-toggle="dropdown" role="button"
                 aria-haspopup="true"
                 aria-expanded="false">
                 Contents <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                    <li><a href="../lists/files.html">Source Files</a></li>
                  <li><a href="../lists/modules.html">Modules</a></li>
                  <li><a href="../lists/procedures.html">Procedures</a></li>
                  <li><a href="../lists/types.html">Derived Types</a></li>
                  <li><a href="../lists/programs.html">Programs</a></li>
              </ul>
            </li>
                <li class="visible-xs hidden-sm visible-lg">
                  <a href="../lists/files.html">Source Files</a>
                </li>
              <li class="visible-xs hidden-sm visible-lg">
                <a href="../lists/modules.html">Modules</a>
              </li>
              <li class="visible-xs hidden-sm visible-lg">
                <a href="../lists/procedures.html">Procedures</a>
              </li>
              <li class="visible-xs hidden-sm visible-lg">
                <a href="../lists/types.html">Derived Types</a>
              </li>
              <li class="visible-xs hidden-sm visible-lg">
                <a href="../lists/programs.html">Programs</a>
              </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>update_zetar
      <small>Subroutine</small>
      
    </h1>
      <div class="row" id="info-bar">
    <div class="col-lg-12">
      <div class="well well-sm">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

          <li id="statements"><i class="fa fa-list-ol"></i>
            <a data-toggle="tooltip"
               data-placement="bottom" data-html="true"
               title=" 0.1% of total for procedures.">51 statements</a>
          </li>

            <li id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/cbl_zetar.F90"> Source File</a>
            </li>
        </ul>
        <ol class="breadcrumb in-well text-right">
              <li><a href='../sourcefile/cbl_zetar.f90.html'>cbl_zetar.F90</a></li>
              <li><a href='../module/cbl_zetar_module.html'>cbl_zetar_module</a></li>
          <li class="active">update_zetar</li>
        </ol>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public  subroutine update_zetar(mp, NITER, canopy_zetar, iter, nrb, CVONK, CGRAV, CCAPP, CLAI_THRESH, CZETmul, CZETPOS, CZETNEG, cable_user_soil_struc, air_rho, met_tk, met_fsd, rough_zref_tq, rough_hruff, rough_term6a, rough_z0soilsn, canopy_vlaiw, canopy_zetash, canopy_us, canopy_fh, canopy_fe, canopy_fhs, canopy_fes)  
</h2>
    

    <h2>Purpose</h2>
<p>This SUBROUTINE updates the value of the stability parameter <script type="math/tex">\xi</script>
 during the iteration loop of the Monin-Obukhov (MO) similarity theory in <a href="../proc/define_canopy.html">define_canopy</a>.<br>
<script type="math/tex">\xi</script> quantifies the role that the surface fluxes play in setting the 
 efficiency of turbulent transfer from the land to the atmosphere, and hence
 the aerodynamic component of the resistance network for those same surface 
 fluxes (an implicit problem which requires iteration to solve).</p>
<p>This SUBROUTINE forms part of the codebase to evaluate the surface
 energy balance on a sub-diurnal basis (i.e. every CABLE time step).
 It resides in the canopy science directory.</p>
<h2>Method</h2>
<p>The two outputs of the SUBROUTINE are:</p>
<ul>
<li><code>canopy_zetar</code>, the local (in space, time and by iteration counter) value of <script type="math/tex">\xi</script>
  (Equation 9). It is evaluated from the total land (soil+canopy)
  surface fluxes of momentum, sensible heat and latent heat.</li>
<li><code>canopy_zetash</code> is the equivalent variable evaluated from the soil
  contribution to those fluxes only. <code>canopy_zetash</code> is used in conjunction
  with the <a href="../module/sli_main_mod.html">sli_main_mod</a> soil model to moderate the fluxes from the soil
  underneath a canopy.</li>
</ul>
<p><code>canopy_zetar</code> and <code>canopy_zetash</code> are initialised to <code>CZETA0</code>=0 in
 <a href="../proc/define_canopy.html">define_canopy</a> and updated <code>NITER</code>(&gt;1) times during the calculation 
 of the energy balance. The value of the variables at each iteration are 
 stored in memory to aid in the diagnosis of convergence.</p>
<p>A special case applies if <code>NITER</code>=2.<br>
<code>canopy_zetar</code> and <code>canopy_zetash</code> are also bounded by the interval 
 <code>[CZETNEG, CZETPOS]</code>.  </p>
<p>The outputs <code>canopy_zetar</code> and <code>canopy_zetash</code> are known as <code>canopy%zetar</code> 
 and <code>canopy%zetash</code> elsewhere in the code. 
 <code>NITER</code>(=4) is defined in <a>cable_types_mod</a>; <code>CZETMUL</code>, <code>CZET0</code>, 
 <code>CZETPOS</code> and <code>CZETNEG</code> in <a href="../module/cable_phys_constants_mod.html">cable_phys_constants_mod</a>.</p>
<h2>References</h2>
<p><a href="http://www.cmar.csiro.au/e-print/open/kowalczykea_2006a.pdf">Kowalczyk et al. (2006)</a>
 - section 3.1, equations 1-9. </p>
<p><br></br></p>
<p><strong>WARNING</strong> The INTENT statements for <code>canopy_zetar</code> and <code>canopy_zetash</code> 
 need to be INTENT(INOUT): currently previous values are reset at each call 
 of the subroutine. It means the initialisations in <a href="../proc/define_canopy.html">define_canopy</a> are 
 useless (the ITER=1 values are lost) and for SLI, on bare soils, 
<code>canopy_zetash</code> gets crazy values for all iterations. </p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th>Type</th>
<th>Intent</th><th>Optional</th>        <th>Attributes</th>
        <th></th>
        <th>Name</th>
        <th></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-mp~4"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>mp</strong></td>
            <td>
                <p>number of land points (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-niter"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>NITER</strong></td>
            <td>
                <p>number of MO-iterations (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_zetar"></span>
              real,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_zetar</strong>(mp,NITER)</td>
            <td>
                <p>stability parameter <script type="math/tex">\xi</script> (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iter~2"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iter</strong></td>
            <td>
                <p>iteration counter (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nrb"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nrb</strong></td>
            <td>
                <p>number of radiation bands (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cvonk~2"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CVONK</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cgrav"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CGRAV</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ccapp"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CCAPP</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-clai_thresh"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CLAI_THRESH</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-czetmul"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CZETmul</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-czetpos"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CZETPOS</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-czetneg"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>CZETNEG</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cable_user_soil_struc"></span>
              character(len=1),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>cable_user_soil_struc</strong></td>
            <td>
                <p>name of soil model used</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-air_rho"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>air_rho</strong>(mp)</td>
            <td>
                <p>air density (kg m<script type="math/tex">^{-3}</script>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-met_tk"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>met_tk</strong>(mp)</td>
            <td>
                <p>reference level air temperature (K)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-met_fsd"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>met_fsd</strong>(mp,nrb)</td>
            <td>
                <p>downwelling shortwave (Wm<script type="math/tex">^{-2}</script>)  </p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rough_zref_tq"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rough_zref_tq</strong>(mp)</td>
            <td>
                <p>reference height for T and q (m)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rough_hruff"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rough_hruff</strong>(mp)</td>
            <td>
                <p>height of canopy (above snow) (m)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rough_term6a"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rough_term6a</strong>(mp)</td>
            <td>
                <p>term from <a href="../proc/ruff_resist.html">ruff_resist</a> (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rough_z0soilsn"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rough_z0soilsn</strong>(mp)</td>
            <td>
                <p>roughness length of soil or snow (m)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_vlaiw"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_vlaiw</strong>(mp)</td>
            <td>
                <p>canopy leaf area (m<script type="math/tex">^2</script>m<script type="math/tex">^{-2}</script>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_zetash"></span>
              real,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_zetash</strong>(mp,NITER)</td>
            <td>
                <p>stability parameter for soil (-)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_us"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_us</strong>(mp)</td>
            <td>
                <p>friction velocity (ms<script type="math/tex">^{-1}</script>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_fh"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_fh</strong>(mp)</td>
            <td>
                <p>sensible heat flux (Wm<script type="math/tex">^{-2}</script>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_fe"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_fe</strong>(mp)</td>
            <td>
                <p>latent heat flux (Wm<script type="math/tex">^{-2}</script>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_fhs"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_fhs</strong>(mp)</td>
            <td>
                <p>soil sensible heat flux (Wm<script type="math/tex">^{-2}</script>) </p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-canopy_fes"></span>
              real,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>canopy_fes</strong>(mp)</td>
            <td>
                <p>soil latent heat flux (Wm<script type="math/tex">^{-2}</script>)</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
        <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  


    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-xs-6 col-md-6"><p>CABLE was developed by CABLE community<br>&copy; 2023 
</p>
          </div>
          <div class="col-xs-6 col-md-6">
            <p class="text-right">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript
         ================================================== -->
         <!-- Placed at the end of the document so the pages load faster -->
    <!--
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        -->
        <script src="../js/bootstrap.min.js"></script>
        <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
        <script src="../js/ie10-viewport-bug-workaround.js"></script>

        <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  </body>
</html>